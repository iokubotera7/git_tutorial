## Snowflakeのアーキテクチャ  
Snowflakeでは3層のアーキテクチャで成り立っている。  
* ストレージ
   * データを保存している領域。
* クエリプロセッシング
  * 仮想ウェアハウスというクエリを実行するコンピュートリソースがある。このレイヤーでクエリ実行する。  
* クラウドサービス
  * インフラ管理、アクセスコントロール、セキュリティ、クエリ最適化などを行うレイヤー

### 仮想ウェアハウスサイズ
XS: 最小のサイズ。クエリが複雑であればあるほど、実行時間がかかる。  
S：2個の仮想ウェアハウスを使うサイズ。  
M: 4個の仮想ウェアハウスを使うサイズ。  

### マルチクラスタリング  
仮想ウェアハウスサイズで処理しきれない場合に、クラスターサイズの仮想ウェアサイズをスケーリングする。  
⇒Auto Scalingみたいな感じ。  仮想ウェアハウスを動的に増加させるイメージ。  

#### スケーリングポリシー
マルチクラスタリング機能による、仮想ウェアハウスのオートスケーリングでは、設定したウェアハウスサイズのスケーリングが可能だが、  
いつスケーリングさせるかを定義するスケーリングポリシーの定義が必要。  

* スタンダード：パフォーマンスの維持を最優先し、クレジット消費の節約は考慮しない。
* エコノミー：クレジット節約を最優先する


## DWH
異なるデータソースを統合し、データを分析できるように加工すること。  

ETLとはデータソースからデータを抽出し、DWSにロードすること。  

ステージングエリア：生データを格納するエリア。内部ステージや外部ステージなどがある。Snowflake内部に存在する必要はない。
データインテグレーション：テーブル同士をリレーションを張ったり、結合したりなどデータ変換する。
アクセスレイヤー：変換したデータからレポート作成、分析、外部アプリからの参照などが可能  

スタンダード・エディションは基本的に入門レベルのエディションであり、標準的な機能はすべて利用できる。  
エンタープライズプラン以上が必要な場合、ビジネスクリティカル  

snowflakeはデータを自動暗号化される。  
複数アカウントでのデータ共有機能もある。  
スタンダードプランでは標準機能はすべて使える。
エンタープライズプランでは、マルチクラスターウェアハウスが使える。  
ビジネスクリティカルでは、エンタープライズプランよりセキュリティが強固になっている。  

## Pricing
* ストレージ料金
  * オンデマンドストレージ：使用した分のみの支払い
  * 容量ストレージ：あらかじめ決まった容量に対する支払いを行う。
  * よくわからなければ、オンデマンドストレージでよい。  
* コンピュート料金：最低1分～1時間あたりの使用量。また、ウェアハウスサイズごとにも料金が異なる。
他の地域にあるアカウントへのデータ転送や他のクラウドプロバイダを使用しているアカウントへのデータ共有の際には、料金が発生。


## フェイルセーフ
障害が発生した際に、データを保護する機能  

## ロール
ACCOUNTADMIN：最上位ロール
SECURITYADMIN：セキュリティのアドミン。ユーザの管理などが可能。
USERADMIN：SECURITYADMINの子ロール。
PUBLIC：最下層のロール。USERADMINの子ロール  

SYSTEMADMIN：ウェアハウスやDB、スキーマなどのオブジェクトを作成できる。  
ベストプラクティスとしては、SYSTEMADMINの子ロールとして、カスタムロールを作成するべき。  


## データローディング方法
・バルクローディング：よく使われる。ウェアハウスとステージを使って行う。コピーコマンドを使う。
・連続的なローディング：即座に最新のデータを取り込む際に使用する。SnowPipeを使う。常に最新データに更新する際に使用。  

## ステージ  
データをロードできるデータベースオブジェクト。  
・外部ステージ：S3バケット、GCP、Azure Blob Storageなど
・内部ステージ：Snowflakeによって管理されるオンプレサーバなど。  

## ロールとは
AWSサービスが他のAWSサービスとの連携をする際に、操作元のサービスに付与する操作先サービスへの操作権限（ポリシー）。  
ロールの内容はAWSポリシーであり、ポリシー内に操作先のAWSサービスに対する許可ポリシーが記述されている。  
例：S3バケットに対する書き込み/読み込みなど  

## ロールの構成
ロールには信頼ポリシーと許可ポリシーの二種類のポリシーで構成されている。  
* 信頼ポリシー：アクセス元のAWSサービスが信頼できるサービスであるかを判断するポリシー
* 許可ポリシー：操作するAWSサービスに対する操作権限をまとめたポリシー

## AWS STSとAssumeRole
AssumeRoleとはAWS STSのサービスの一種であり、IAMロールに設定した権限を一時的に使えるようにトークンを発行する行為。  
AWS STSとは、「AWSサービスに対して何等かの操作をしたいときに、一時的に操作する権利（トークン）を発行する」サービスである。  
上記、トークンというのは、正確に言うと一時的な認証情報「アクセスキー」「シークレットキー」「セッショントークン」が発行される。  

⇒AssumeRoleで発行したトークンを利用することで、IAMロールに設定されているポリシーに記載されている権限を用いて、他のAWSサービスを操作できるようになる。

## IAMロールの信頼ポリシー
IAMロールはユーザなどに一時的な操作権限を委譲する際にも利用される。


## スイッチロールとは
スイッチロールとはAWSにログインした状態のまま複数のAWSアカウントにスイッチすることが可能。  
スイッチ後の権限は、スイッチ先のIAMロールへあらかじめ設定したポリシーが適応される。

## Permissions boundary
IAMユーザに対して権限境界を設定して、付与可能な権限範囲をあらかじめ制限できる。
Permission boundaryを使用することで、IAMユーザごとに許可可能な権限を設定できる。  
使用方法は、IAMポリシーとPermission boundaryで両方に含まれている権限のみをIAMユーザに設定する。  

## AWS Organizations
複数のAWSアカウントを一元管理できるAWSサービス。複数のAWSアカウントをグループ化し、そのグループごとに共通のポリシーを設定できる。  
例えばｍ企業内の部署ごとにAWSアカウントをグループ化し、このサービスをA部署が利用できるようにし、B部署では利用できないようにする」というような設定が可能。  

## AWS Organizationsの仕組み  
AWS Organizationsでは、複数のAWSアカウントを組織として管理する。  
組織内のAWSアカウントでは「管理アカウント」とメンバーアカウントで分けられる。
* 管理アカウント：一つの組織に一つだけ存在するアカウント。組織全体の管理権限を持つ。
* メンバーアカウント：管理アカウント以外のアカウント

## AWS Organizationsでできること
* AWSアカウントの一元管理
*   組織単位（OU）を定義し、グループ単位でサービスコントロールポリシー(SCP)を設定できる。
* 新規アカウントの作成・管理
* 請求とコストの一元管理
* アカウント間のリソース共有

## AWS CloudWatchとは
EC2やRDSなどのAWSサービスやオンプレミスのサーバなどを監視できるサービス。  
各AWSリソースの変更をトリガーに何かアクションを起こしたり（CloudWatchイベント）、EC2のCPU使用率やディスクの読み取り量などを記録・監視する（CloudWatchメトリクス）ことが可能です。  
トリガーに何か起こす⇒CloudWatchイベント
CPU使用率などを監視する⇒CloudWatchメトリクス  

### CloudWatchメトリクス
各リソースから収集したデータを時系列にまとめたもの。  

### CloudWatchエージェント
EC2の中で動いているアプリケーションのデータやEC2の中のログなどを収集できる。

### CloudWatchログ
ログを文字列として保存したり、ログに特定の文字列があった際にアラームを出すことができるサービス。  
ログは、AWS CloudTrail, Amazon Kinesis Data Streams, AWS Lambdaからログを収集することが可能。  
また、CloudWatchエージェントを使用すれば、EC2内のアプリケーションやオンプレミスサーバからもログを集めている。ログから、特定内容の文字列があった場青、アラームを出すことができる。  

### CloudWatchアラーム
時系列にまとめたリソースから収集したデータであるメトリクスから特定の値になった際にアラームを出すサービス。 

## ネットワークの範囲
プライベートネットワークを分割する、範囲を指定するのにサブネットを用いる。
IPアドレスには、ネットワーク部とホスト部があり、32ビットあるIPアドレスのうち、先頭からnビットまでをNW部とするとすることをサブネットマスクという。  
考え方を単純化すると、

## EC2とRDSの接続

1. RDS用のセキュリティグループの作成
2. RDSを設置するプライベートサブネットを作成
3. RDSが属するプライベートサブネットを設定するサブネットグループを作成
4. RDSの起動
5. EC2からRDSへ接続

192.168.1.1/16の場合、192.168までをネットワーク部としてロックし、1.1がホスト部となり、16ビット分の台数をホストとして自由にできる  
そのため、AWSのVPCなどでは以下のようになることが多い。  

VPC：10.0.0.0/16　：10.0までは固定。それ以降の0.0は自由。
パブリックサブネット：10.0.1.0/24 ：10.0.1までは固定。それ以降は自由。
プライベートサブネット：10.0.2.0/24：10.0.2までは固定。それ以降は自由。なぜなら、サブネットマスクが24だから先頭から24ビットまでは固定になる。

## Autoスケーリンググループの作成
ターゲット追跡スケーリングでは、設定したターゲット値を維持するようにスケールアウト・スケールインを行う  

## ECSによるコンテナ作成
1. Cloud9でdockerイメージ作成環境を作成
2. Cloud9上でDockerfileを作成し、docker buildコマンドを実行してイメージを作成
3. ECR内にプライベートリポジトリを作成する
4. 


## Dockerfileの書き方

FROM ベースイメージ(OSの指定)
RUN イメージ作成するためのコマンド(apt updateなど)
EXPOSE コンテナが使用するポート番号
CMD コマンド起動時に実行するコマンド

docker build -t イメージ格納先 .

例：ECRのプライベートリポジトリに格納する場合
docker build -t 778421944754.dkr.ecr.ap-northeast-1.amazonaws.com/hello-world .
ECS：コンテナオーけすとれーた：何のコンテナをどう動かすか命令を出す
Fargate：コンテナの実行環境：コンテナが稼働する環境  

Fargateはサーバレスでコンテナを実行可能な環境  

ALBの作成
AZごとにFarget上でコンテナを起動

クラスター：コンテナを動かすための論理的なグループ
Fargate上でコンテナを起動する方法
1. ECSのクラスターを作成する
2. タスク定義を作成
　・コンテナ定義、要求するPCU&メモリなど定義する。つまりタスク定義でECRに格納したイメージを指定することで、コンテナをFargateで起動できる  
 3. サービスを作成する
 4.   コンテナをいくつ作成するのか、ELBとどのように連携するのか定義する。自動復旧機能もある。つまり、コンテナに障害が発生した際に、自動再生成してくれる機能


タスクの作成：
 6. 
4. 



